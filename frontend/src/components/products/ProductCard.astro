---
/**
 * ProductCard Component
 *
 * Displays a product in grid/list view with image, pricing, and CTA
 * Optimized for conversion with clear pricing and benefits
 *
 * @example
 * <ProductCard product={product} />
 */

import ProductImage from '../ProductImage.astro';
import type { Product } from '../../lib/products';

export interface Props {
  product: Product;
  /** Show full details or compact view */
  variant?: 'default' | 'compact' | 'featured';
  /** Additional CSS classes */
  class?: string;
}

const { product, variant = 'default', class: className = '' } = Astro.props;

const isFeatured = variant === 'featured' || product.featured;
const isCompact = variant === 'compact';
---

<a
  href={`/products/${product.slug}`}
  class={`product-card group block ${className}`}
  data-product-slug={product.slug}
>
  <!-- Image Container -->
  <div class="relative overflow-hidden rounded-lg mb-4">
    <ProductImage
      publicId={product.images.primary}
      alt={product.name}
      variant="card"
      loading="lazy"
      class="w-full transition-transform duration-300 group-hover:scale-105"
    />

    <!-- Badges -->
    <div class="absolute top-3 right-3 flex flex-col gap-2">
      {isFeatured && (
        <span class="badge-success shadow-md">
          ⭐ Featured
        </span>
      )}
      {product.certifications && product.certifications.includes('Certified Organic') && (
        <span class="badge bg-accent-600 text-white shadow-md">
          Certified Organic
        </span>
      )}
      {!product.inStock && (
        <span class="badge bg-warm-400 text-warm-900">
          Out of Stock
        </span>
      )}
    </div>
  </div>

  <!-- Product Info -->
  <div class="space-y-3">
    <!-- Category -->
    <div class="text-xs uppercase tracking-wider text-secondary-600 font-semibold">
      {product.category}
    </div>

    <!-- Product Name -->
    <h3 class="font-display font-bold text-xl text-warm-900 group-hover:text-primary-600 transition-colors line-clamp-2">
      {product.name}
    </h3>

    <!-- Description -->
    {!isCompact && (
      <p class="text-sm text-warm-700 line-clamp-2">
        {product.description}
      </p>
    )}

    <!-- Key Benefits (Featured only) -->
    {variant === 'featured' && product.benefits.length > 0 && (
      <ul class="space-y-1">
        {product.benefits.slice(0, 3).map(benefit => (
          <li class="text-sm text-warm-700 flex items-start gap-2">
            <span class="text-accent-600 mt-0.5">✓</span>
            <span>{benefit}</span>
          </li>
        ))}
      </ul>
    )}

    <!-- Pricing -->
    <div class="flex items-baseline justify-between pt-2 border-t border-secondary-200">
      <div>
        <span class="price text-2xl">${product.price}</span>
        <span class="text-sm text-warm-600 ml-1">/ {product.unit}</span>
      </div>

      <!-- CTA Button -->
      <button
        class="btn-primary text-sm px-4 py-2 opacity-0 group-hover:opacity-100 transition-opacity"
        onclick="event.preventDefault(); /* Add to cart logic */"
      >
        View Details →
      </button>
    </div>

    <!-- Stock Status -->
    {product.inStock ? (
      <p class="text-xs text-accent-600 font-semibold">✓ In Stock - Ready to Ship</p>
    ) : (
      <p class="text-xs text-warm-500">Out of Stock</p>
    )}
  </div>
</a>

<style>
  .product-card {
    transition: all 0.2s ease-in-out;
  }

  .product-card:hover {
    transform: translateY(-2px);
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
